# å¿«é€Ÿå¼€å§‹ - å¢å¼ºä½ å·²æœ‰çš„splatfactoè§†é¢‘

## TL;DRï¼ˆç›´æ¥ç”¨ï¼‰

ä½ å·²ç»æœ‰è®­ç»ƒå¥½çš„splatfactoæ¨¡å‹å’Œæ¸²æŸ“çš„è§†é¢‘ï¼Ÿ**ä¸éœ€è¦é‡æ–°è®­ç»ƒï¼**

```bash
# æ–¹æ³•1: ä¸€é”®å¢å¼ºè§†é¢‘ï¼ˆæœ€ç®€å•ï¼‰
python enhance_existing_video.py --input your_video.mp4 --output enhanced.mp4

# æ–¹æ³•2: ä½¿ç”¨å‚è€ƒå›¾åƒï¼ˆæ•ˆæœæ›´å¥½ï¼‰
python enhance_existing_video.py \
    --input your_video.mp4 \
    --output enhanced.mp4 \
    --use-ref \
    --ref-images /path/to/your/training/images
```

## ä¸‰ç§æ–¹æ³•å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä½ å·²ç»æœ‰äº†                                  â”‚
â”‚                                                                   â”‚
â”‚      4å¸§è®­ç»ƒå›¾åƒ â†’ splatfactoè®­ç»ƒ â†’ æ¸²æŸ“è§†é¢‘                       â”‚
â”‚                                      â†“                            â”‚
â”‚                                  æœ‰ä¸€äº›artifacts                  â”‚
â”‚                             (æ¨¡ç³Šã€floatersç­‰)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   ç°åœ¨å¯ä»¥é€‰æ‹©ï¼š      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚                          â”‚
        â†“                          â†“                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–¹æ³•A: Difix3D+ â”‚         â”‚ æ–¹æ³•B: Difix3D  â”‚         â”‚ æ–¹æ³•C: åªç”¨Difix â”‚
â”‚  (åå¤„ç†)      â”‚         â”‚  (é‡æ–°è®­ç»ƒ)     â”‚         â”‚  (æœ€ç®€å•)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚                          â”‚
       â†“                          â†“                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ä¸éœ€è¦é‡è®­    â”‚         â”‚ âŒ éœ€è¦é‡è®­      â”‚         â”‚ âœ… ä¸éœ€è¦é‡è®­    â”‚
â”‚ âš¡ 5-10åˆ†é’Ÿ    â”‚         â”‚ ğŸ¢ 30åˆ†é’Ÿ-1å°æ—¶  â”‚         â”‚ âš¡ 5åˆ†é’Ÿ       â”‚
â”‚ ğŸ’° ç”¨ç°æœ‰æ¨¡å‹   â”‚         â”‚ ğŸ’° ä»å¤´å¼€å§‹      â”‚         â”‚ ğŸ’° ç”¨ç°æœ‰è§†é¢‘   â”‚
â”‚ ğŸ¯ å»é™¤artifactsâ”‚         â”‚ ğŸ¯ 3Då‡ ä½•ä¹Ÿæ”¹è¿›   â”‚         â”‚ ğŸ¯ å»é™¤artifactsâ”‚
â”‚ ğŸ“Š æ•ˆæœ: å¥½     â”‚         â”‚ ğŸ“Š æ•ˆæœ: æœ€å¥½     â”‚         â”‚ ğŸ“Š æ•ˆæœ: ä¸­ç­‰   â”‚
â”‚                â”‚         â”‚                â”‚         â”‚                â”‚
â”‚ æ¨è: â­â­â­â­â­  â”‚         â”‚ æ¨è: â­â­â­     â”‚         â”‚ æ¨è: â­â­â­â­   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦ç»†è¯´æ˜ï¼š

#### æ–¹æ³•A: Difix3D+ï¼ˆåå¤„ç†ï¼Œ**æ¨èï¼**ï¼‰
- å¯¹æ¸²æŸ“çš„**æ¯ä¸€å¸§**ç”¨Difixæ¨¡å‹è¿›è¡Œå¢å¼º
- éœ€è¦å‚è€ƒå›¾åƒï¼ˆä½ è®­ç»ƒæ—¶ç”¨çš„4å¸§ï¼‰æ¥å¼•å¯¼
- æ•ˆæœæœ€å¥½ï¼Œå› ä¸ºç»“åˆäº†3Dä¸€è‡´æ€§

#### æ–¹æ³•B: Difix3Dï¼ˆé‡æ–°è®­ç»ƒï¼‰
- ä»å¤´é‡æ–°è®­ç»ƒ3DGSï¼Œä½†åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨Difixæ¸è¿›æ”¹è¿›
- 3Då‡ ä½•ä¹Ÿä¼šæ”¹è¿›ï¼Œä¸åªæ˜¯å›¾åƒè´¨é‡
- å¦‚æœä½ å¯¹ç°æœ‰æ¨¡å‹ä¸æ»¡æ„ï¼Œå¯ä»¥è¯•è¯•è¿™ä¸ª

#### æ–¹æ³•C: åªç”¨Difixï¼ˆæœ€ç®€å•ï¼‰
- ç›´æ¥å¯¹è§†é¢‘å¸§è¿›è¡Œå¢å¼ºï¼Œä¸ä½¿ç”¨å‚è€ƒå›¾åƒ
- æœ€å¿«é€Ÿï¼Œä½†æ•ˆæœç›¸å¯¹å·®ä¸€ç‚¹
- é€‚åˆå¿«é€Ÿé¢„è§ˆ

---

## ä½¿ç”¨æ–¹æ³•Aï¼ˆæ¨èï¼‰ï¼šDifix3D+

### åœºæ™¯ï¼šä½ å·²ç»æœ‰æ¸²æŸ“å¥½çš„è§†é¢‘

```bash
# 1. å‡†å¤‡ä½ çš„æ–‡ä»¶
# - your_video.mp4: ä½ ç”¨splatfactoæ¸²æŸ“çš„è§†é¢‘
# - training_images/: ä½ è®­ç»ƒsplatfactoç”¨çš„4å¸§å›¾åƒ

# 2. è¿è¡Œå¢å¼º
python enhance_existing_video.py \
    --input your_video.mp4 \
    --output enhanced.mp4 \
    --use-ref \
    --ref-images training_images/

# 3. å®Œæˆï¼å¯¹æ¯”æŸ¥çœ‹
# enhanced.mp4 ä¼šæ¯” your_video.mp4 æ›´æ¸…æ™°ï¼Œartifactsæ›´å°‘
```

### åœºæ™¯ï¼šä½ è¿˜æ²¡æ¸²æŸ“ï¼Œæœ‰nerfstudio checkpoint

```bash
# 1. ç”¨nerfstudioæ¸²æŸ“è§†é¢‘
ns-render camera-path \
    --load-config /path/to/your/config.yml \
    --camera-path-filename camera_path.json \
    --output-path rendered_video.mp4

# 2. å¢å¼º
python enhance_existing_video.py \
    --input rendered_video.mp4 \
    --output enhanced.mp4 \
    --use-ref \
    --ref-images /path/to/training/images

# æˆ–è€…ç›´æ¥æ¸²æŸ“æˆå¸§ï¼Œç„¶åå¤„ç†å¸§
ns-render camera-path \
    --load-config config.yml \
    --camera-path-filename camera_path.json \
    --output-path rendered_frames/ \
    --output-format images

python enhance_existing_video.py \
    --input rendered_frames/ \
    --output enhanced_frames/ \
    --use-ref \
    --ref-images /path/to/training/images
```

---

## ä½¿ç”¨æ–¹æ³•Cï¼ˆæœ€ç®€å•ï¼‰ï¼šåªç”¨Difix

å¦‚æœä½ åªæƒ³å¿«é€Ÿçœ‹çœ‹æ•ˆæœï¼Œä¸ç”¨å‚è€ƒå›¾åƒï¼š

```bash
python enhance_existing_video.py \
    --input your_video.mp4 \
    --output enhanced.mp4

# ä¸éœ€è¦ --use-ref å’Œ --ref-images
```

---

## ä½¿ç”¨æ–¹æ³•Bï¼ˆé‡æ–°è®­ç»ƒï¼‰ï¼šDifix3D

å¦‚æœä½ æƒ³ä»å¤´é‡æ–°è®­ç»ƒï¼Œä½“éªŒpaperçš„å®Œæ•´æ–¹æ³•ï¼š

### æ­¥éª¤1: å‡†å¤‡æ•°æ®ï¼ˆCOLMAPæ ¼å¼ï¼‰

```bash
# å¦‚æœä½ çš„æ•°æ®æ˜¯nerfstudioæ ¼å¼ï¼Œéœ€è¦æ‰¾åˆ°COLMAPæ•°æ®
# nerfstudioé€šå¸¸åœ¨è¿™é‡Œç”ŸæˆCOLMAPæ•°æ®ï¼š
# data/nerfstudio/your_scene/colmap/
```

### æ­¥éª¤2: è®­ç»ƒDifix3D

```bash
# ä½¿ç”¨gsplatç‰ˆæœ¬
python examples/gsplat/simple_trainer_difix3d.py default \
    --data_dir data/your_scene \
    --result_dir outputs/difix3d/your_scene \
    --data_factor 4 \
    --max_steps 30000 \
    --fix_steps 3000 6000 9000 12000 15000 18000 21000 24000 27000 30000

# æˆ–ä½¿ç”¨nerfstudioç‰ˆæœ¬
cd examples/nerfstudio
pip install -e .
cd ../..

ns-train difix3d \
    --data data/your_scene \
    --output-dir outputs/difix3d/your_scene \
    --max-num-iterations 30000 \
    nerfstudio-data --downscale-factor 4
```

---

## å®é™…æ•ˆæœå¯¹æ¯”

### åŸå§‹splatfactoæ¸²æŸ“:
- âŒ ä¸€äº›åŒºåŸŸæ¨¡ç³Š
- âŒ å¯èƒ½æœ‰floatersï¼ˆæ¼‚æµ®çš„é«˜æ–¯ç‚¹ï¼‰
- âŒ ç¨€ç–åŒºåŸŸç»†èŠ‚ç¼ºå¤±

### ä½¿ç”¨Difix3D+å¢å¼ºå:
- âœ… æ›´æ¸…æ™°çš„ç»†èŠ‚
- âœ… å»é™¤floaters
- âœ… æ›´çœŸå®çš„çº¹ç†
- âœ… ä¿æŒ3Dä¸€è‡´æ€§ï¼ˆå› ä¸ºç”¨äº†å‚è€ƒå›¾åƒï¼‰

---

## å¸¸è§é—®é¢˜

### Q: æˆ‘çš„è§†é¢‘å¾ˆå¤§ï¼ˆå‡ ç™¾å¸§ï¼‰ï¼Œä¼šä¸ä¼šå¾ˆæ…¢ï¼Ÿ

A: Difixæ˜¯å•æ­¥diffusionï¼Œå¾ˆå¿«ï¼å¤§çº¦æ¯å¸§0.5-1ç§’ã€‚
- 100å¸§ â‰ˆ 1-2åˆ†é’Ÿ
- 300å¸§ â‰ˆ 5åˆ†é’Ÿ
- 1000å¸§ â‰ˆ 15åˆ†é’Ÿ

### Q: ä¸€å®šè¦ç”¨å‚è€ƒå›¾åƒå—ï¼Ÿ

A: ä¸ä¸€å®šï¼Œä½†**å¼ºçƒˆæ¨è**ã€‚
- ä¸ç”¨å‚è€ƒï¼šæ•ˆæœè¿˜è¡Œï¼Œä½†å¯èƒ½æœ‰ä¸ä¸€è‡´
- ç”¨å‚è€ƒï¼šæ•ˆæœæ›´å¥½ï¼Œä¿æŒ3Dä¸€è‡´æ€§

### Q: å‚è€ƒå›¾åƒé€‰å“ªäº›ï¼Ÿ

A: è„šæœ¬ä¼šè‡ªåŠ¨é€‰æ‹©ã€‚åŸç†ï¼š
- å¯¹äºæ¯ä¸€å¸§æ¸²æŸ“ï¼Œé€‰æ‹©è§†è§’æœ€æ¥è¿‘çš„è®­ç»ƒå›¾åƒä½œä¸ºå‚è€ƒ
- ä½ åªéœ€è¦æä¾›è®­ç»ƒå›¾åƒæ–‡ä»¶å¤¹ï¼Œè„šæœ¬è‡ªåŠ¨å¤„ç†

### Q: æˆ‘çš„GPUæ˜¾å­˜ä¸å¤Ÿï¼Ÿ

A: å¯ä»¥é™ä½åˆ†è¾¨ç‡ï¼š

```python
# ä¿®æ”¹ enhance_existing_video.py ä¸­çš„ enhance_frames å‡½æ•°
# åœ¨ pipe(**kwargs).images[0] ä¹‹å‰æ·»åŠ ï¼š

# é™ä½åˆ†è¾¨ç‡
image = image.resize((image.width // 2, image.height // 2))
if ref_image:
    ref_image = ref_image.resize((ref_image.width // 2, ref_image.height // 2))
```

### Q: èƒ½ç”¨CPUè¿è¡Œå—ï¼Ÿ

A: ç†è®ºä¸Šå¯ä»¥ï¼Œä½†ä¼š**éå¸¸æ…¢**ã€‚å»ºè®®è‡³å°‘æœ‰ä¸€å¼ GPUã€‚

ä¿®æ”¹è„šæœ¬ä¸­çš„ï¼š
```python
pipe.to("cuda")  # æ”¹ä¸º
pipe.to("cpu")
```

---

## å®Œæ•´ç¤ºä¾‹

å‡è®¾ä½ çš„æ–‡ä»¶ç»“æ„ï¼š

```
my_project/
â”œâ”€â”€ training_images/          # è®­ç»ƒç”¨çš„4å¸§
â”‚   â”œâ”€â”€ frame_0000.png
â”‚   â”œâ”€â”€ frame_0009.png
â”‚   â”œâ”€â”€ frame_0019.png
â”‚   â””â”€â”€ frame_0029.png
â”œâ”€â”€ rendered_video.mp4        # splatfactoæ¸²æŸ“çš„è§†é¢‘
â””â”€â”€ config.yml                # nerfstudioé…ç½®
```

å¢å¼ºè§†é¢‘ï¼š

```bash
cd /home/user/Difix3D

python enhance_existing_video.py \
    --input ~/my_project/rendered_video.mp4 \
    --output ~/my_project/enhanced_video.mp4 \
    --use-ref \
    --ref-images ~/my_project/training_images/ \
    --fps 30

# å®Œæˆåå¯¹æ¯”ï¼š
# åŸå§‹: ~/my_project/rendered_video.mp4
# å¢å¼º: ~/my_project/enhanced_video.mp4
```

---

## æŠ€æœ¯åŸç†ï¼ˆç®€å•è§£é‡Šï¼‰

### Difixæ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ

```
è¾“å…¥ï¼šæœ‰artifactsçš„3DGSæ¸²æŸ“å›¾ + ï¼ˆå¯é€‰ï¼‰å‚è€ƒå›¾åƒ
  â†“
[Difixæ¨¡å‹] - åŸºäºSD-Turboçš„å•æ­¥æ‰©æ•£æ¨¡å‹
  â†“          è®­ç»ƒç›®æ ‡ï¼šæ¨¡ç³Šå›¾â†’æ¸…æ™°å›¾
è¾“å‡ºï¼šå¹²å‡€çš„å›¾åƒ
```

### ä¸ºä»€ä¹ˆéœ€è¦å‚è€ƒå›¾åƒï¼Ÿ

```
åœºæ™¯ï¼šæ¸²æŸ“novel viewï¼ˆæ–°è§†è§’ï¼‰

ä¸ç”¨å‚è€ƒå›¾åƒï¼š
  æ¨¡å‹åªçœ‹åˆ°æ¸²æŸ“å›¾ï¼ŒçŒœæµ‹ä»€ä¹ˆæ˜¯artifacts
  â†“
  å¯èƒ½ä¸å¤Ÿå‡†ç¡®ï¼Œæˆ–ç”Ÿæˆä¸ä¸€è‡´çš„ç»†èŠ‚

ç”¨å‚è€ƒå›¾åƒï¼š
  æ¨¡å‹åŒæ—¶çœ‹åˆ°ï¼š
  1. æ¸²æŸ“å›¾ï¼ˆçŸ¥é“å¤§è‡´å‡ ä½•å’Œè§†è§’ï¼‰
  2. å‚è€ƒå›¾ï¼ˆçŸ¥é“çœŸå®çº¹ç†å’Œç»†èŠ‚ï¼‰
  â†“
  æ›´å‡†ç¡®åœ°æ¢å¤ç»†èŠ‚ï¼Œä¿æŒ3Dä¸€è‡´æ€§
```

---

## æ€§èƒ½å‚è€ƒ

åœ¨RTX 3090ä¸Šï¼š

| ä»»åŠ¡ | æ—¶é—´ |
|------|------|
| åŠ è½½Difixæ¨¡å‹ | ~5ç§’ |
| å¤„ç†1å¸§ï¼ˆä¸ç”¨refï¼‰ | ~0.5ç§’ |
| å¤„ç†1å¸§ï¼ˆç”¨refï¼‰ | ~0.8ç§’ |
| å¤„ç†100å¸§è§†é¢‘ | ~1-2åˆ†é’Ÿ |
| å¤„ç†1000å¸§è§†é¢‘ | ~10-15åˆ†é’Ÿ |

---

## ä¸‹ä¸€æ­¥

è¯•è¯•çœ‹æ•ˆæœï¼å¦‚æœæ»¡æ„ï¼Œå¯ä»¥ï¼š

1. è°ƒæ•´å‚æ•°ï¼ˆåˆ†è¾¨ç‡ã€å‚è€ƒå›¾åƒé€‰æ‹©ç­‰ï¼‰
2. å°è¯•æ–¹æ³•Bï¼ˆé‡æ–°è®­ç»ƒï¼‰çœ‹èƒ½å¦è¿›ä¸€æ­¥æå‡
3. ç”¨åœ¨ä½ çš„å…¶ä»–3DGS/NeRFé¡¹ç›®ä¸Š

æœ‰é—®é¢˜éšæ—¶é—®ï¼
